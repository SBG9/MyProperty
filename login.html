<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login - MyProperty</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* Inline adjustments for login page */
.container{max-width:450px;margin:60px auto;padding:20px}
.card{background:#fff;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.1)}
input,select,button{width:100%;padding:10px;margin-top:10px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
button{background:#22c55e;color:#fff;border:none;cursor:pointer}
button.secondary{background:#2563eb;margin-top:5px}
p.forgot{cursor:pointer;color:#2563eb;margin-top:10px;text-align:center}
</style>
</head>
<body>

<!-- Header -->
<header class="navbar">
  <div class="logo"><b>MyProperty</b></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="login.html">Login</a>
    <a href="register.html">Register</a>
  </nav>
</header>

<div class="container">
  <!-- Login Card -->
  <!-- <div class="card" id="loginCard">   //// change number 1
    <h2>Login</h2>
    <input id="email" placeholder="Email / Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button class="secondary" onclick="location.href='register.html'">Register</button>
    <p class="forgot" onclick="showForgot()">Forgot Password?</p>
  </div> -->

  <div class="card" id="loginCard">
  <h2>Login</h2>
  <input id="email" placeholder="Email / Username (optional)">
  <!-- <input id="mobile" placeholder="Mobile Number (compulsory)" required> ////last modified 3rd modified --> 
  <!-- <input id="mobile"
       placeholder="Mobile Number (compulsory)"
       pattern="[6-9][0-9]{9}"
       required> -->
  <input id="mobile"
       placeholder="Mobile Number (compulsory)"
       required>
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button class="secondary" onclick="location.href='register.html'">Register</button>
  <p class="forgot" onclick="showForgot()">Forgot Password?</p>
</div>


  <!-- Forgot Password Card -->
  <!-- <div class="card" id="forgotCard" style="display:none">  //// change 2
    <h2>Forgot Password</h2>
    <input id="fpEmail" placeholder="Enter your registered Email">
    <button onclick="verifyUser()">Next</button>
    <div id="securitySection" style="display:none;margin-top:15px;">
      <p id="secQuestion"></p>
      <input id="secAnswer" placeholder="Answer">
      <input id="newPassword" type="password" placeholder="New Password">
      <button onclick="resetPassword()">Reset Password</button>
    </div>
  </div> -->

<div class="card" id="forgotCard" style="display:none">
  <h2>Forgot Password</h2>
  <input id="fpEmailMobile" placeholder="Enter your registered Email or Mobile" required>
  <button onclick="verifyUser()">Next</button>
  <div id="securitySection" style="display:none;margin-top:15px;">
    <p id="secQuestion"></p>
    <input id="secAnswer" placeholder="Answer">
    <input id="newPassword" type="password" placeholder="New Password">
    <button onclick="resetPassword()">Reset Password</button>
  </div>
</div>


</div>

<footer>
  Need help? Contact our developers: <br>
  Email: dev@myproperty.xcom | Phone: +91 98765xxxxx
</footer>

<script>
  function login(){
  let users = JSON.parse(localStorage.getItem('users')) || [];

  if(users.length === 0){
    alert('No users found. Please register first.');
    return;
  }

  let email = document.getElementById('email').value.trim();
  let mobile = document.getElementById('mobile').value.trim();
  let password = document.getElementById('password').value;

  if(!/^[6-9][0-9]{9}$/.test(mobile)){
    alert('Enter valid 10 digit mobile number');
    return;
  }

  if(!password){
    alert('Password is required');
    return;
  }

  // let user = users.find(u =>
  //   (email === "" || u.email === email || u.name === email) &&
  //   u.mobile === mobile &&
  //   u.password === password
  // );
  let user = users.find(u =>
  u.mobile === mobile &&
  u.password === password &&
  (
    email === "" ||
    u.email === email ||
    u.name === email
  )
);


if(!user){
    alert('Wrong credentials');
    return;
}

  // localStorage.setItem('loggedIn', 'yes');
  // localStorage.setItem('currentUser', JSON.stringify(user));  -----------
localStorage.setItem('isLoggedIn', 'yes');
localStorage.setItem('loggedInUser', JSON.stringify(user));


  location.href = 'dashboard.html';
}



/* ---------- FORGOT PASSWORD ---------- */

// function showForgot(){
//   document.getElementById('loginCard').style.display='none';
//   document.getElementById('forgotCard').style.display='block';
// } //// juna code 
function showForgot(){
  document.getElementById('loginCard').style.display='none';
  document.getElementById('forgotCard').style.display='block';

  // reset forgot password state
  document.getElementById('securitySection').style.display='none';
  document.getElementById('fpEmailMobile').value = '';
  document.getElementById('secAnswer').value = '';
  document.getElementById('newPassword').value = '';
  fpUser = null;
}


let fpUser = null;

function verifyUser(){
  let users = JSON.parse(localStorage.getItem('users')) || [];
  let val = document.getElementById('fpEmailMobile').value.trim();

  fpUser = users.find(u => u.email === val || u.mobile === val);

  if(!fpUser){
    alert("Email / Mobile not found");
    return;
  }

  document.getElementById('secQuestion').innerText =
    "Security Question: " + fpUser.sq;

  document.getElementById('securitySection').style.display='block';
}

function resetPassword(){

  if(!fpUser){  // newelly added code 3rd moifiy
  alert("Session expired. Try again.");
  return;
}

  let ans = document.getElementById('secAnswer').value.trim().toLowerCase();
  let newPass = document.getElementById('newPassword').value;

  if(ans !== fpUser.sa.toLowerCase()){
    alert("Wrong security answer");
    return;
  }

  if(newPass.length < 6){
    alert("Password must be at least 6 characters");
    return;
  }

  let users = JSON.parse(localStorage.getItem('users'));
  // let index = users.findIndex(u => u.email === fpUser.email);   //// 3rd modify mor mobil login compatibility
  let index = users.findIndex(
  u => u.email === fpUser.email || u.mobile === fpUser.mobile
);

if(index === -1){
  alert("User not found");
  return;
}
// update password in users array
  users[index].password = newPass;

  localStorage.setItem('users', JSON.stringify(users));

  alert("Password reset successful. Login now.");

  document.getElementById('forgotCard').style.display='none';
  document.getElementById('loginCard').style.display='block';
}
</script>


</body>
</html>
