<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Properties | MyProperty</title>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f5f7fb}

/* NAVBAR */
.navbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 40px;
  background:#0f172a;
  color:#fff
}
.navbar a{
  color:#00ffd9;
  text-decoration:none;
  margin-left:18px;
  font-weight:600
}

/* LAYOUT */
.container{max-width:1200px;margin:40px auto}
.card{
  background:#fff;
  padding:22px;
  border-radius:14px;
  box-shadow:0 0 12px rgba(0,0,0,.1)
}

/* PROPERTY CARD */
.property-card{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f9fafb;
  padding:18px;
  border-radius:12px;
  margin-top:15px
}
.property-info{
  flex:1
}
.property-info b{
  font-size:18px
}
.property-info span{
  display:block;
  color:#555;
  margin-top:4px
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  margin-top:6px
}
.available{background:#dcfce7;color:#166534}
.sold{background:#fee2e2;color:#991b1b}

/* ACTIONS */
.property-actions button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-left:8px;
  color:#fff
}
.edit{background:#2563eb}
.delete{background:#dc2626}
.toggle{background:#16a34a}

.add-btn{
  background:#22c55e;
  border:none;
  color:#fff;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold
}

footer{
  text-align:center;
  padding:15px;
  background:#0f172a;
  color:#fff;
  margin-top:50px
}
</style>
</head>

<body>

<!-- NAVBAR -->
<header class="navbar">
  <div><b>MyProperty</b></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="add-property.html">Add Property</a>
    <a href="my-properties.html">My Properties</a>
    <a href="saved-properties.html">Saved</a>
    <!-- <a href="logout.html">Logout</a> -->
    <a href="#" onclick="logout()">Logout</a>

  </nav>
</header>

<div class="container">
  <div class="card">
    <h2>My Properties</h2>
    <button class="add-btn" onclick="location.href='add-property.html'">➕ Add New Property</button>

    <div id="propList"></div>
  </div>
</div>

<footer>
© 2025 MyProperty
</footer>
<script>
// ================= LOGIN CHECK =================
const isLoggedIn = localStorage.getItem("isLoggedIn") === "yes";
let user = JSON.parse(localStorage.getItem("loggedInUser"));
let users = JSON.parse(localStorage.getItem("users")) || [];
let properties = JSON.parse(localStorage.getItem("properties")) || [];

if(!isLoggedIn || !user){
  window.location.replace("auth.html");
}

// user related properties only
function getMyProperties(){
  return properties.filter(p => p.ownerId === user.id);
}

// ================= RENDER =================
render();

function render(){
  const list = document.getElementById("propList");
  list.innerHTML = "";

  const myProps = getMyProperties();

  if(myProps.length === 0){
    list.innerHTML = "<p style='margin-top:15px'>No properties added yet.</p>";
    return;
  }

  myProps.forEach((p)=>{
    const div = document.createElement("div");
    div.className = "property-card";

    div.innerHTML = `
      <div class="property-info">
        <b>${p.type}</b>
        <span>${p.location.city}, ${p.location.district || ""}</span>
        <span>₹ ${p.price}</span>
        <span class="badge ${p.status === 'Available' ? 'available' : 'sold'}">
          ${p.status}
        </span>
      </div>

      <div class="property-actions">
        <button class="edit" onclick="editProperty(${p.id})">Edit</button>
        <button class="toggle" onclick="toggleStatus(${p.id})">Toggle</button>
        <button class="delete" onclick="deleteProperty(${p.id})">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });

  updateDashboardStats();
}

// ================= EDIT =================
function editProperty(id){
  let p = properties.find(x => x.id === id);
  if(!p) return;

  let price = prompt("Update Price", p.price);
  if(price === null) return;

  p.price = Number(price);
  saveAll();
}

// ================= DELETE =================
function deleteProperty(id){
  if(!confirm("Delete this property?")) return;

  properties = properties.filter(p => p.id !== id);
  saveAll();
}

// ================= TOGGLE STATUS =================
function toggleStatus(id){
  let p = properties.find(x => x.id === id);
  if(!p) return;

  p.status = p.status === "Available" ? "Sold" : "Available";
  saveAll();
}

// ================= SAVE =================
function saveAll(){
  localStorage.setItem("properties", JSON.stringify(properties));

  user.totalProperties = getMyProperties().length;
  user.sold = getMyProperties().filter(p => p.status === "Sold").length;

  localStorage.setItem("loggedInUser", JSON.stringify(user));

  let index = users.findIndex(u => u.id === user.id);
  if(index !== -1){
    users[index] = user;
    localStorage.setItem("users", JSON.stringify(users));
  }

  render();
}

// ================= DASHBOARD STATS =================
function updateDashboardStats(){
  user.totalProperties = getMyProperties().length;
  user.sold = getMyProperties().filter(p => p.status === "Sold").length;

  localStorage.setItem("loggedInUser", JSON.stringify(user));
}

// ================= LOGOUT =================
function logout(){
  localStorage.removeItem("loggedInUser");
  localStorage.removeItem("isLoggedIn");
  window.location.replace("auth.html");  //11 jan
}


//p.status === "Available" ? "Sold" : "Available"  // this line for currect sold propertis auto upadate in home page

</script>

</body>
</html>
